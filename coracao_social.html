<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Star ‚òÖ | RFL‚Ä¢‚òÖ‚Ä¢REAL</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #121212; color: white; display: grid; grid-template-columns: 250px 1fr 300px; height: 100vh; }
        
        /* Sidebar Esquerda */
        nav { background-color: #1a1a1a; border-right: 1px solid #333; padding: 20px; }
        nav h2 { color: #ff0050; margin-bottom: 30px; font-size: 1.5rem; text-transform: uppercase; }
        nav ul { list-style: none; }
        nav ul li { padding: 15px 10px; border-radius: 8px; cursor: pointer; transition: 0.3s; margin-bottom: 5px; }
        nav ul li:hover { background-color: #333; color: #00f2ea; }

        /* Feed Central */
        main { overflow-y: auto; padding: 20px; background-color: #000; }
        .post-input { background: #1a1a1a; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #333; }
        .post-input textarea { width: 100%; background: transparent; border: none; color: white; font-size: 1.1rem; resize: none; outline: none; min-height: 80px; }
        .btn-post { background: linear-gradient(45deg, #ff0050, #00f2ea); border: none; padding: 10px 25px; color: white; border-radius: 20px; font-weight: bold; float: right; cursor: pointer; }
        
        /* Itens do Feed */
        .feed-item { background: #1a1a1a; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; transition: 0.3s; }
        .feed-item img { width: 100%; max-width: 600px; height: auto; border-radius: 12px; margin: 15px auto; display: block; border: 1px solid #333; }
        
        /* Sidebar Direita */
        aside { background-color: #1a1a1a; border-left: 1px solid #333; padding: 20px; }
        .trending-box { background: #252525; padding: 15px; border-radius: 10px; }
        .tag { color: #ff0050; display: block; margin-bottom: 10px; text-decoration: none; font-weight: bold; }

        /* Estilo do Chat */
        #btn-abrir-chat { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(45deg, #ff0050, #00f2ea); padding: 12px 22px; border-radius: 30px; cursor: pointer; font-weight: bold; color: white; z-index: 9999; }
        #janela-chat { position: fixed; bottom: 85px; right: 20px; width: 320px; height: 450px; background: #1a1a1a; border: 1px solid #333; border-radius: 15px; display: none; flex-direction: column; z-index: 10001; box-shadow: 0 10px 40px rgba(0,0,0,0.8); overflow: hidden; }
        .chat-header { background: #222; padding: 12px; display: flex; justify-content: space-between; border-bottom: 1px solid #333; color: #00f2ea; }
        #mensagens-chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #121212; }
        .msg-item { background: #252525; padding: 8px 12px; border-radius: 10px; font-size: 0.9rem; color: #eee; }
        .chat-input-area { padding: 10px; display: flex; background: #1a1a1a; border-top: 1px solid #333; }
        #input-msg-chat { flex: 1; background: #000; border: 1px solid #444; color: white; padding: 8px; border-radius: 20px; outline: none; }
    </style>
</head>
<body>

    <nav>
        <h2>Social Star ‚òÖ</h2>
        <ul>
            <li>üè† In√≠cio</li>
            <li onclick="mudarFotoPerfil()" style="color: #00f2ea; font-weight: bold;">üì∏ Mudar Foto</li>
            <li onclick="realizarLogout()" style="color: #ff4d6d; margin-top: 20px;">üö™ Sair</li>
        </ul>
    </nav>

    <main>
        <div class="post-input">
            <textarea id="post-texto" placeholder="O que est√° acontecendo?"></textarea>
            <input type="file" id="post-foto" accept="image/*" style="margin-top: 10px; color: #888;">
            <button class="btn-post" onclick="publicarPost()">Publicar</button>
            <div style="clear: both;"></div>
        </div>
        <div id="feed"></div>
    </main>

    <aside>
        <div class="trending-box">
            <h3>Comunidade</h3>
            <p id="membros-count" style="color: #00f2ea; font-weight: bold; margin-bottom: 15px;">Aguardando sinal...</p>
            <hr style="border: 0.1px solid #333; margin-bottom: 15px;">
            <h3>Tend√™ncias</h3>
            <a href="#" class="tag">#RFL_REAL</a>
            <a href="#" class="tag">#SocialStar2026</a>
        </div>
    </aside>

    <div id="btn-abrir-chat" onclick="toggleChat()">üí¨ Chat Global</div>
    <div id="janela-chat">
        <div class="chat-header">
            <span>ChatGlobal</span>
            <button onclick="toggleChat()" style="background:none; border:none; color:white; cursor:pointer;">‚úñ</button>
        </div>
        <div id="mensagens-chat"></div>
        <div class="chat-input-area">
            <input type="text" id="input-msg-chat" placeholder="Digite..." onkeypress="if(event.key === 'Enter') enviarMensagemChat()">
            <button onclick="enviarMensagemChat()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;">üöÄ</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCnYzszGEiEkiU9TxwT1ONS2HIEluDHSKM",
            authDomain: "siteloginraphael.firebaseapp.com",
            projectId: "siteloginraphael",
            storageBucket: "siteloginraphael.firebasestorage.app",
            messagingSenderId: "194238150810",
            appId: "1:194238150810:web:8dffbb5f42efd7ea8c0723"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- MONITOR DE AUTENTICA√á√ÉO (DIRECIONAMENTO REMOVIDO) ---
        auth.onAuthStateChanged((user) => {
            carregarFeed();
            atualizarContagemMembros();
            ouvirMensagensChat();
            
            if (user) {
                console.log("Status: Conectado como " + user.email);
            } else {
                console.log("Status: Navegando em modo visitante.");
            }
        });

        // --- FUN√á√ïES DO FEED ---
        async function publicarPost() {
            const texto = document.getElementById('post-texto').value;
            const fotoArquivo = document.getElementById('post-foto').files[0];
            const user = auth.currentUser;

            if (!user) { alert("RFL‚Ä¢‚òÖ‚Ä¢REAL, voc√™ precisa estar logado para postar."); return; }
            if (!texto.trim() && !fotoArquivo) return;

            try {
                let urlFotoPost = "";
                if (fotoArquivo) {
                    const formData = new FormData();
                    formData.append("image", fotoArquivo);
                    const res = await fetch("https://api.imgbb.com/1/upload?key=ede86576a675116955921d850f5cd7e3", { method: "POST", body: formData });
                    const data = await res.json();
                    urlFotoPost = data.data.url;
                }

                await db.collection("posts_sociais").add({
                    autor: user.email,
                    mensagem: texto,
                    fotoUrl: urlFotoPost,
                    data: firebase.firestore.FieldValue.serverTimestamp()
                });

                document.getElementById('post-texto').value = "";
                document.getElementById('post-foto').value = "";
            } catch (e) { alert("Erro ao publicar."); }
        }

        function carregarFeed() {
            db.collection("posts_sociais").orderBy("data", "desc").onSnapshot(snapshot => {
                const feed = document.getElementById('feed');
                feed.innerHTML = "";
                snapshot.forEach(doc => {
                    const p = doc.data();
                    feed.innerHTML += `
                        <div class="feed-item">
                            <h4 style="color:#00f2ea; margin-bottom:10px;">@${p.autor ? p.autor.split('@')[0] : 'an√¥nimo'}</h4>
                            <p>${p.mensagem || ""}</p>
                            ${p.fotoUrl ? `<img src="${p.fotoUrl}">` : ""}
                        </div>`;
                });
            });
        }

        // --- FUN√á√ïES DO CHAT ---
        function toggleChat() {
            const chat = document.getElementById('janela-chat');
            chat.style.display = (chat.style.display === "flex") ? "none" : "flex";
        }

        async function enviarMensagemChat() {
            const input = document.getElementById('input-msg-chat');
            const user = auth.currentUser;
            if (!input.value.trim() || !user) return;
            
            await db.collection("chat_global").add({
                texto: input.value,
                autor: user.email.split('@')[0],
                data: firebase.firestore.FieldValue.serverTimestamp()
            });
            input.value = "";
        }

        function ouvirMensagensChat() {
            db.collection("chat_global").orderBy("data", "asc").limitToLast(20).onSnapshot(snapshot => {
                const chatDiv = document.getElementById('mensagens-chat');
                chatDiv.innerHTML = "";
                snapshot.forEach(doc => {
                    const m = doc.data();
                    chatDiv.innerHTML += `<div class="msg-item"><b>${m.autor}:</b> ${m.texto}</div>`;
                });
                chatDiv.scrollTop = chatDiv.scrollHeight;
            });
        }

        function realizarLogout() { 
            auth.signOut().then(() => {
                alert("Sess√£o encerrada.");
            });
        }

        function atualizarContagemMembros() {
            db.collection("usuarios").get().then(snap => {
                document.getElementById('membros-count').innerText = snap.size + " Membros ativos";
            });
        }
    </script>
</body>
</html>
